<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, get, child} from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";
       
        const firebaseConfig = {
          apiKey: "AIzaSyCLSrZi0FK0BYS17MR8NjVSF9hxIl-XXJI",
          authDomain: "chating-test-1abe9.firebaseapp.com",
          databaseURL: "https://chating-test-1abe9-default-rtdb.firebaseio.com",
          projectId: "chating-test-1abe9",
          storageBucket: "chating-test-1abe9.appspot.com",
          messagingSenderId: "224195817800",
          appId: "1:224195817800:web:be1ea02c848aae4830037d"
        };
      
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        enter.addEventListener('click', (snapshot)=>{
            if(document.getElementById('id').value && document.getElementById('password-in').value == document.getElementById('password-check').value){
                get(child(ref(database), '/'+document.getElementById('id').value+'/')).then((snapshot)=>{
                    if(snapshot.exists() == false){
                        set(ref(database, '/'+document.getElementById('id').value), {
                            password: document.getElementById('password-in').value
                        });
                        alert('회원가입에 성공하였습니다.');
                        document.getElementById('id').value = "";
                        document.getElementById('password-in').value = "";
                        document.getElementById('password-check').value = "";
                    }    
                    else{
                        alert('중복된 아이디입니다. 다시 입력해주세요.');
                        document.getElementById('id').value = "";
                        document.getElementById('password-in').value = "";
                        document.getElementById('password-check').value = "";
                    }
                })
            }
            else if(document.getElementById('id').value == ""){
                alert('아이디를 입력하세요.');
            }
            else{
                alert('비밀번호가 다릅니다.');
            }
        })

        back.addEventListener('click', ()=>{
            location.href = "login.htm";
        })
    </script>
</head>
<body class="container">
    <div class="mt-3">아이디</div>
    <input type="text" id="id" class="form-control w-100 mt-1" placeholder="아이디 입력">
    <div class="mt-3">비밀번호</div>
    <input type="password" id="password-in" class="form-control w-100 mt-1" placeholder="비밀번호 입력">
    <div class="mt-3">비밀번호 확인</div>
    <input type="password" id="password-check" class="form-control w-100 mt-1" placeholder="비밀번호 한번 더 입력">
    <button type="submit" id="enter" class="btn btn-success mt-1 w-100">아이디 생성</button>
    <button type="submit" id="back" class="btn btn-warning mt-1">돌아가기</button>
</body>
</html>